<form hx-put="/communities/{{ community_id }}"
      hx-target="this"
      hx-swap="outerHTML">
    {% if error_message %}
    <div style="color: red; margin-bottom: 10px;">
        <strong>{{ error_message }}</strong>
    </div>
    {% endif %}
    <div>
        <label>{{ ftl_get_message("community-name") }}:</label>
        <input type="text" name="name" value="{{ community.name }}">
    </div>
    <div>
        <label>ID:</label>
        <input type="text" name="slug" value="{{ community.slug }}">
    </div>
    <div class="form-group">
        <label>{{ ftl_get_message("community-description") }}:</label>
        <textarea name="description">{{ community.description }}</textarea>
    </div>
    {% if community.visibility == "private" %}
    <div>
        <label>{{ ftl_get_message("community-visibility") }}:</label>
        <input type="text" value="{{ ftl_get_message("visibility-private") }}" disabled>
        <input type="hidden" name="visibility" value="private">
        <br />
        <small>{{ ftl_get_message("visibility-cannot-change") }}</small>
    </div>
    {% else %}
    <fieldset>
        <legend>{{ ftl_get_message("community-visibility") }}:</legend>
        <p>
            <label>
                <input type="radio" name="visibility" value="public"
                       {% if community.visibility == "public" %}checked{% endif %} />
                {{ ftl_get_message("visibility-public") }}
                <br />
                <small>{{ ftl_get_message("visibility-public-description") }}</small>
            </label>
        </p>
        <p>
            <label>
                <input type="radio" name="visibility" value="unlisted"
                       {% if community.visibility == "unlisted" %}checked{% endif %} />
                {{ ftl_get_message("visibility-unlisted") }}
                <br />
                <small>{{ ftl_get_message("visibility-unlisted-description") }}</small>
            </label>
        </p>
    </fieldset>
    {% endif %}
    <div class="post-menu">
        <button class="btn" hx-get="/communities/{{ community_id }}">{{ ftl_get_message("cancel") }}</button>
        <button class="btn">{{ ftl_get_message("save") }}</button>
    </div>
</form>

<div class="danger-zone" style="margin-top: 3rem; padding: 1.5rem; border: 2px solid #dc2626; border-radius: 0.5rem; background-color: #fef2f2;">
    <h3 style="color: #991b1b; margin-top: 0;">{{ ftl_get_message("community-delete-danger-zone") }}</h3>
    <p style="color: #991b1b; margin-bottom: 1rem;">
        {{ ftl_get_message("community-delete-warning") }}
    </p>

    <form id="delete-community-form" style="margin-top: 1rem;">
        <label for="confirm-slug" style="display: block; margin-bottom: 0.5rem;">
            {{ ftl_get_message("community-delete-confirm-prompt") }} <strong>{{ community.slug }}</strong>:
        </label>
        <input
            type="text"
            id="confirm-slug"
            name="confirm-slug"
            autocomplete="off"
            style="width: 100%; padding: 0.5rem; margin-bottom: 1rem; border: 1px solid #d1d5db; border-radius: 0.375rem;"
        />

        <button
            type="button"
            id="delete-community-btn"
            class="btn"
            disabled
            hx-delete="/communities/{{ community_id }}/delete"
            hx-confirm="{{ ftl_get_message("community-delete-final-confirm") }}"
            hx-target="body"
            hx-swap="innerHTML"
            style="background-color: #dc2626; color: white; cursor: not-allowed;"
        >
            {{ ftl_get_message("community-delete-button") }}
        </button>
    </form>
</div>

<script>
(function() {
    const confirmInput = document.getElementById('confirm-slug');
    const deleteBtn = document.getElementById('delete-community-btn');
    const communitySlug = '{{ community.slug }}';

    if (confirmInput && deleteBtn) {
        confirmInput.addEventListener('input', function(e) {
            if (e.target.value === communitySlug) {
                deleteBtn.disabled = false;
                deleteBtn.style.cursor = 'pointer';
                deleteBtn.style.backgroundColor = '#dc2626';
            } else {
                deleteBtn.disabled = true;
                deleteBtn.style.cursor = 'not-allowed';
                deleteBtn.style.backgroundColor = '#9ca3af';
            }
        });
    }
})();
</script>
