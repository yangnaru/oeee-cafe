<div id="post-reactions-{{ post_id }}" class="post-reactions">
  <span class="reaction-total">
    {% set total_count = reaction_counts | map(attribute='count') | sum %}
    {% if login_name %}
      <a href="/@{{ login_name }}/{{ post_id }}/reactions">
        {{ total_count }}
        {% if total_count == 1 %}
          {{ ftl_get_message("post-reaction") }}
        {% else %}
          {{ ftl_get_message("post-reactions") }}
        {% endif %}
      </a>
    {% elif post %}
      <a href="/@{{ post.community_slug if post.community_slug else post.login_name }}/{{ post_id }}/reactions">
        {{ total_count }}
        {% if total_count == 1 %}
          {{ ftl_get_message("post-reaction") }}
        {% else %}
          {{ ftl_get_message("post-reactions") }}
        {% endif %}
      </a>
    {% else %}
      {{ total_count }}
      {% if total_count == 1 %}
        {{ ftl_get_message("post-reaction") }}
      {% else %}
        {{ ftl_get_message("post-reactions") }}
      {% endif %}
    {% endif %}
  </span>
  {% for reaction in reaction_counts %}
    {% if current_user %}
      <button class="reaction-button {% if reaction.reacted_by_user %}reacted{% endif %}"
              hx-post="{% if reaction.reacted_by_user %}/posts/{{ post_id }}/reactions/remove{% else %}/posts/{{ post_id }}/reactions/add{% endif %}"
              hx-vals='{"emoji": "{{ reaction.emoji }}"}'
              hx-target="#post-reactions-{{ post_id }}"
              hx-swap="outerHTML"
              title="{% if reaction.reacted_by_user %}Remove your {{ reaction.emoji }}{% else %}React with {{ reaction.emoji }}{% endif %}">
        {{ reaction.emoji }} {{ reaction.count }}
      </button>
    {% else %}
      <span class="reaction-button-readonly" title="Sign in to react">{{ reaction.emoji }} {{ reaction.count }}</span>
    {% endif %}
  {% endfor %}
</div>
